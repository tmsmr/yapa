class YapaConfig{constructor(){this.updatePeriodMs=10,this.fadeInDurationMs=2e3,this.nodeDensityFactor=1,this.nodeVelocityFactor=1,this.nodeRadius=2,this.nodeColor="#444",this.connsEnabled=!0,this.maxConnDistance=200,this.connLineWidth=1,this.connColor="#666",this.transmissionsEnabled=!0,this.transmissionSpawnPeriodMaxMs=1e3,this.transmissionSpeedFactor=1,this.trasmissionColorA="#00FF00",this.trasmissionColorB="#0000FF",this.transmissionWidthFactor=1.25,this.transmissionsDrawPackets=!0}}class Yapa{constructor(t,s){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.container=t,this.container.appendChild(this.canvas),this.conf=s}reset(){this.pixelRatio=window.devicePixelRatio||1,this.canvas.width=this.container.clientWidth*this.pixelRatio,this.canvas.height=this.container.clientHeight*this.pixelRatio,1!==this.pixelRatio&&(this.canvas.style.width=this.container.clientWidth+"px",this.canvas.style.height=this.container.clientHeight+"px"),this.squaredMaxConnDistance=this.conf.maxConnDistance*this.conf.maxConnDistance*this.pixelRatio*this.pixelRatio,this.fadeInAlpha=0,this.transmissions=[],this.populate()}populate(){const t=[];var s=[this.canvas.width,this.canvas.height];let i=Math.floor(this.container.clientWidth*this.container.clientHeight/1e4*this.conf.nodeDensityFactor);for(;i--;)t.push(new YapaNode(s,this.conf.nodeVelocityFactor*this.pixelRatio,this.conf.nodeRadius*this.conf.transmissionWidthFactor));this.nodes=t}tick(){if(!document.hidden){for(const s of this.nodes)s.update();this.fadeInAlpha<1?this.fadeInAlpha+=1/(this.conf.fadeInDurationMs/this.conf.updatePeriodMs):this.fadeInAlpha=1;for(const i of this.transmissions)for(const n of i.sections)if(n[2]<100){i.current=n;var t=this.nodes[n[0]].squaredDistanceTo(this.nodes[n[1]]),t=Math.sqrt(t);n[2]+=this.conf.transmissionSpeedFactor*this.conf.maxConnDistance/t*this.pixelRatio,100<n[2]&&(n[2]=100);break}this.transmissions=this.transmissions.filter(t=>t.sections[t.sections.length-1][2]<100)}setTimeout(this.tick.bind(this),this.conf.updatePeriodMs)}draw(){0<this.nodes.length&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawNodes(),this.conf.connsEnabled&&this.drawConns(),this.conf.transmissionsEnabled&&this.drawTransmissions()),window.requestAnimationFrame(this.draw.bind(this))}drawNodes(){this.ctx.globalAlpha=this.fadeInAlpha,this.ctx.fillStyle=this.conf.nodeColor;for(const t of this.nodes)this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.conf.nodeRadius*this.pixelRatio,0,2*Math.PI),this.ctx.fill()}drawConns(){this.ctx.strokeStyle=this.conf.connColor,this.ctx.lineWidth=this.conf.connLineWidth*this.pixelRatio;for(let s=0;s<this.nodes.length;s++)for(let t=s+1;t<this.nodes.length;t++){const o=this.nodes[s];var i=this.nodes[t],n=o.squaredDistanceTo(i);n>this.squaredMaxConnDistance||(this.ctx.globalAlpha=(1-n/this.squaredMaxConnDistance)*this.fadeInAlpha,this.ctx.beginPath(),this.ctx.moveTo(o.x,o.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke())}}drawTransmissions(){this.ctx.lineWidth=this.conf.connLineWidth*this.pixelRatio*this.conf.transmissionWidthFactor;for(const o of this.transmissions){this.ctx.strokeStyle=o.color,this.ctx.fillStyle=o.color;let t=1;1===o.sections.length?t=1-2*Math.abs(o.sections[0][2]-50)/100:(o.sections[0][2]<100&&(t=o.sections[0][2]/100),0<o.sections[o.sections.length-1][2]&&(t=1-o.sections[o.sections.length-1][2]/100));for(const e of o.sections){const h=this.nodes[e[0]];var s=this.nodes[e[1]];this.ctx.globalAlpha=(1-h.squaredDistanceTo(s)/this.squaredMaxConnDistance+1)/2*this.fadeInAlpha*t,this.ctx.beginPath(),this.ctx.moveTo(h.x,h.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke()}this.ctx.globalAlpha=this.fadeInAlpha*t,this.ctx.beginPath(),this.ctx.arc(this.nodes[o.sections[0][0]].x,this.nodes[o.sections[0][0]].y,this.conf.nodeRadius*this.pixelRatio*this.conf.transmissionWidthFactor,0,2*Math.PI),this.ctx.fill();for(const a in o.sections){var i=this.nodes[o.sections[a][1]];let t=this.conf.nodeRadius*this.pixelRatio;a===o.sections.length-1&&(t*=this.conf.transmissionWidthFactor),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,t,0,2*Math.PI),this.ctx.fill()}var n;this.conf.transmissionsDrawPackets&&(n=[(this.nodes[o.current[1]].x-this.nodes[o.current[0]].x)*o.current[2]*.01,(this.nodes[o.current[1]].y-this.nodes[o.current[0]].y)*o.current[2]*.01],this.ctx.beginPath(),this.ctx.arc(n[0]+this.nodes[o.current[0]].x,n[1]+this.nodes[o.current[0]].y,this.conf.nodeRadius*this.conf.transmissionWidthFactor*this.pixelRatio,0,2*Math.PI),this.ctx.fill())}}startTransmission(){if(!document.hidden&&2<=this.nodes.length){var s=Math.floor(Math.random()*this.nodes.length);let t=s;for(;s===t;)t=Math.floor(Math.random()*this.nodes.length);var i,n=this.shortestPath(s,t);n&&(i=YapaColorHelpers.randColorInGradient(this.conf.trasmissionColorA,this.conf.trasmissionColorB),this.transmissions.push(new YapaTransmission(n,i)))}setTimeout(this.startTransmission.bind(this),Math.random()*this.conf.transmissionSpawnPeriodMaxMs)}shortestPath(i,n){this.nodes.forEach(t=>t.initPathFindingState());let o=i;for(this.nodes[o].distance=0;;){let s=void 0;for(let t=0;t<this.nodes.length;t++){var e;o===t||this.nodes[t].visited||((e=this.nodes[o].squaredDistanceTo(this.nodes[t]))>this.squaredMaxConnDistance||(e=Math.sqrt(e),(e+=this.nodes[o].distance)<this.nodes[t].distance&&(this.nodes[t].distance=e,this.nodes[t].parent=o),(!s||e<s[1])&&(s=[t,e])))}if(this.nodes[o].visited=!0,s)o=s[0];else{let s=void 0;for(let t=0;t<this.nodes.length;t++)this.nodes[t].visited||(!s||this.nodes[t].distance<s[1])&&(s=[t,this.nodes[t].distance]);if(!s){const h=[];h.push(n);let t=this.nodes[n].parent;for(;t!==i;){if(void 0===t)return;h.push(t),t=this.nodes[t].parent}return h.push(t),h.reverse()}o=s[0]}}}start(){this.reset(),this.tick(),this.conf.transmissionsEnabled&&this.startTransmission(),this.draw(),window.addEventListener("resize",this.reset.bind(this))}}class YapaNode{constructor(t,s,i){this.area=t,this.x=Math.floor(Math.random()*(this.area[0]-i)),this.x<i&&(this.x=i),this.y=Math.floor(Math.random()*(this.area[1]-i)),this.y<i&&(this.y=i),this.dx=(Math.random()-.5)*s,this.dy=(Math.random()-.5)*s,this.padding=i,this.visited=void 0,this.distance=void 0,this.parent=void 0}update(){(this.x+this.dx+this.padding>this.area[0]||this.x+this.dx-this.padding<0)&&(this.dx=-this.dx),(this.y+this.dy+this.padding>this.area[1]||this.y+this.dy-this.padding<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy}squaredDistanceTo(t){var s=this.x-t.x,t=this.y-t.y;return s*s+t*t}initPathFindingState(){this.visited=!1,this.distance=1/0,this.parent=void 0}}class YapaTransmission{constructor(s,t){this.sections=[];for(let t=1;t<s.length;t++)this.sections.push([s[t-1],s[t],0]);this.current=this.sections[0],this.color=t}}class YapaColorHelpers{static toHexStr(t){return 1===(t=(t=Math.ceil(t)).toString(16)).length?"0"+t:t}static randColorInGradient(t,s){t=t.replace("#",""),s=s.replace("#","");var i=Math.random(),n=parseInt(t.substring(0,2),16)*i+parseInt(s.substring(0,2),16)*(1-i),o=parseInt(t.substring(2,4),16)*i+parseInt(s.substring(2,4),16)*(1-i),t=parseInt(t.substring(4,6),16)*i+parseInt(s.substring(4,6),16)*(1-i);return"#"+YapaColorHelpers.toHexStr(n)+YapaColorHelpers.toHexStr(o)+YapaColorHelpers.toHexStr(t)}}
